webpackJsonp([29],{Eder:function(t,e,o){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=o("ozpw"),a=o("ZTjp"),s=o("+RvV"),n={components:{AddGoods:r.a,ImportMsg:a.a},data:function(){return{warehouseArr:[],typeArr:[],supplierArr:[],provideModal:!1,provideForm:{date:(new Date).toLocaleDateString(),warehouse:"",type:"",supplier:"",purchaser:""},applyDepartArr:[],goodsCols:[{type:"index",title:"序号",align:"center",width:65,key:"sortNum"},{title:"物品名称",align:"center",key:"name"},{title:"物品编码",align:"center",key:"code"},{title:"物品分类",align:"center",key:"classify"},{title:"品牌",align:"center",key:"brand"},{title:"规格/型号",align:"center",key:"model"},{title:"单位",align:"center",key:"unit"},{title:"当前库存",align:"center",key:"currentInventory"},{title:"入库数量",align:"center",slot:"number",key:"number",renderHeader:function(t,e){return t("div",[t("span",{class:"zd-cm-required"},"入库数量")])}},{title:"价格",align:"center",slot:"price",key:"price",renderHeader:function(t,e){return t("div",[t("span",{class:"zd-cm-required"},"价格")])}},{title:"金额",align:"center",slot:"amount",key:"amount"}],formGoodsData:{attrData:[]},provideRemarkForm:{remark:""},ruleValidate:{date:[{required:!0,type:"date",message:"不能为空",trigger:"change"}],warehouse:[{required:!0,message:"不能为空",trigger:"change"}],type:[{required:!0,message:"不能为空",trigger:"change"}]},saveLoading:!1,leaderArr:[],loading:!1,date:"",addGoodsModal:!1,delId:"",delIndex:"",curIndex:null,code:"",editId:"",editOrderNO:"",importModal:!1,importForm:{file:null,fileName:""},importErrorMsg:[]}},created:function(){var t=this;this.getIntoKindList().then(function(e){var o=e.data;t.typeArr=o,o.length>0&&(t.provideForm.type=o[0].code)}),this.getGoodsSupplierAllEnable().then(function(e){t.supplierArr=e.data}),this.getChargedStoreRoom().then(function(e){var o=e.data;t.warehouseArr=o,o.length>0&&(t.provideForm.warehouse=o[0].id)});var e=new Date;this.date=e.getFullYear()+"-"+this.fillZero(e.getMonth()+1)+"-"+this.fillZero(e.getDate()),this.$store.dispatch("getBaseInfo").then(function(e){t.remoteMethod(e.userName),t.provideForm.purchaser=e.userId})},computed:{userName:function(){return this.$store.state.userName}},methods:{changeDate:function(t){this.provideForm.date=t},toPutIn:function(){this.$router.push({path:"/putIn"})},handleSummary:function(t){var e=t.columns,o=t.data,r={};return e.forEach(function(t,e){var a=t.key;if(0!==e){var s=o.map(function(t){return Number(t[a])});if(s.every(function(t){return isNaN(t)})||8!==e&&10!==e)r[a]={key:a,value:""};else{var n=s.reduce(function(t,e){var o=Number(e);return isNaN(o)?t:t+e},0);r[a]={key:a,value:n}}}else r[a]={key:a,value:"合计"}}),r},remoteMethod:function(t){var e=this;this.selectLeader(t).then(function(t){e.leaderArr=t.data})},addGoodsHandle:function(){if(""!==this.provideForm.warehouse){this.addGoodsModal=!0;var t=this.formGoodsData.attrData,e=[];t.map(function(t){e.push(t.id)}),this.$refs.child.getKind("0"),this.$refs.child.selectedArr=t.slice(),this.$refs.child.selectedArrId=e}else this.postWarningTip("请先选择入库仓库")},saveGoodsHandle:function(){this.addGoodsModal=!1,this.formGoodsData.attrData=this.$refs.child.selectedArr.slice(),this.getInventoryByParam(this.$refs.child.selectedArrId.join(","),this.provideForm.warehouse)},getInventoryByParam:function(t,e){var o=this;BaseAxios({method:"post",url:"/sr/storeroomData!getInventoryByParam.action",data:{goodsInfoIds:t,warehouseId:e}}).then(function(t){var e=t.data,r=function(t){o.formGoodsData.attrData.map(function(r){r.id===t&&(o.$set(r,"currentInventory",e[t].inventory),o.$set(r,"priceList",e[t].priceList))})};for(var a in e)r(a)}).catch(function(t){o.postErrorTip("请求失败"),console.log(t)})},getGoodsByCodeHandle:function(){""!==this.code?this.getGoodsByCode(this.code):this.postWarningTip("请输入物品编码进行添加")},getGoodsByCode:function(t){var e=this,o=this.formGoodsData.attrData.map(function(t){return t.id});this.getGoodsInfoByUseType("0","","",t).then(function(t){t.data.map(function(t){o.indexOf(t.id)<0&&(e.formGoodsData.attrData.push({id:t.id,name:t.name,code:t.code,classify:t.goodsKind,brand:t.brand,model:t.size,unit:t.unit,number:null,currentInventory:null,price:null,amount:null,priceList:[]}),e.getInventoryByParam(t.id,e.provideForm.warehouse))}),e.code=""})},setHistoryPrice:function(t){this.formGoodsData.attrData[this.curIndex].price=parseInt(t),this.formGoodsData.attrData[this.curIndex].amount=this.formGoodsData.attrData[this.curIndex].price*this.formGoodsData.attrData[this.curIndex].number},getCurrIndex:function(t){this.curIndex=t,this.formGoodsData.attrData[this.curIndex].amount=this.formGoodsData.attrData[this.curIndex].price*this.formGoodsData.attrData[this.curIndex].number},saveOrUpdateIntoWarehouseRecord:function(t,e,o,r,a,s,n,i,d){var m=this,l={};l["warehouseRecord.date"]=t,l["warehouseRecord.warehouse.id"]=e,l["warehouseRecord.intoKind"]=o,""!==r&&(l["warehouseRecord.goodsSupplier.id"]=r),""!==a&&(l["warehouseRecord.buyer.id"]=a),l["warehouseRecord.note"]=s,l["warehouseRecord.code"]=i,l["warehouseRecord.id"]=d,n.map(function(t,e){l["intoWarehouseGoodsVOs["+e+"].goodsInfoId"]=t.id,l["intoWarehouseGoodsVOs["+e+"].count"]=t.number,l["intoWarehouseGoodsVOs["+e+"].unitPrice"]=t.price,l["intoWarehouseGoodsVOs["+e+"].sum"]=t.amount}),BaseAxios({method:"post",url:"/sr/storeroomData!saveOrUpdateIntoWarehouseRecord.action",data:l}).then(function(t){m.saveLoading=!1,m.toPutIn()}).catch(function(t){m.saveLoading=!1,m.postErrorTip("请求失败"),console.log(t)})},handleSubmit:function(){var t=!1,e=!1;if(this.$refs.provideForm.validate(function(e){e&&(t=!0)}),this.formGoodsData.attrData.length<=0)this.postWarningTip("请添加物品");else if(this.$refs.formGoodsData.validate(function(t){t&&(e=!0)}),t&&e){this.saveLoading=!0;var o=new Date(this.provideForm.date),r=o.getFullYear()+"-"+this.fillZero(o.getMonth()+1)+"-"+this.fillZero(o.getDate());this.saveOrUpdateIntoWarehouseRecord(r,this.provideForm.warehouse,this.provideForm.type,this.provideForm.supplier,this.provideForm.purchaser,this.provideRemarkForm.remark,this.formGoodsData.attrData,this.editOrderNO,this.editId)}},clickRowHandle:function(t,e){this.delId===t.id?(this.delId="",this.delIndex=""):(this.delId=t.id,this.delIndex=e)},rowClassName:function(t,e){return this.delId===t.id?"demo-table-info-row":""},delRowHandle:function(){if(""===this.delIndex)return this.postWarningTip("请选择删除的物品");if(this.formGoodsData.attrData.splice(this.delIndex,1),this.$refs.child.selectedArrId.indexOf(this.delId)>-1){var t=this.$refs.child.selectedArrId.indexOf(this.delId);this.$refs.child.selectedArr.splice(t,1),this.$refs.child.selectedArrId.splice(t,1)}},importHandle:function(){""!==this.provideForm.warehouse?(this.importErrorMsg=[],this.importModal=!0,this.$refs.importForm.resetFields(),this.importForm.file=null):this.postWarningTip("请先选择入库仓库")},handleUpload:function(t){return s.c.regImportType.test(t.name)?(this.importForm.file=t,this.importForm.fileName=t.name,this.$refs.importForm.validateField("fileName")):this.postWarningTip(s.c.regImportTypeMsg),!1},importSubmit:function(t){var e=this;this.$refs[t].validate(function(t){t&&(e.saveLoading=!0,e.saveImport())})},saveImport:function(){var t=this,e=new FormData;e.append("id",this.provideForm.warehouse),e.append("upload",this.importForm.file),BaseAxios({method:"post",url:"/sr/storeroomData!importIntoGoodsInfo.action",data:e,processData:!1,contentType:!1,transformRequest:[function(t){return t}]}).then(function(e){var o=e.data;"1"===o.errorCode?t.importErrorMsg=o.msg:(t.importModal=!1,t.importForm.file=null,o.listData.map(function(e){t.formGoodsData.attrData.push({id:e.id,name:e.name,code:e.code,classify:e.goodsKind,brand:e.brand,model:e.size,unit:e.unit,number:e.count,currentInventory:e.inventory,price:e.unitPrice,amount:e.sum,priceList:[]})})),t.saveLoading=!1}).catch(function(e){t.saveLoading=!1,t.importModal=!1,t.postErrorTip("请求失败"),t.$refs.upload.value="",console.log(e)})}},mounted:function(){}},i=o("W5g0");var d=function(t){o("pXtw")},m=Object(i.a)(n,function(){var t=this,e=t.$createElement,o=t._self._c||e;return o("div",{staticClass:"zd-common-component"},[o("Form",{ref:"provideForm",staticClass:"zd-cm-applyForm",attrs:{model:t.provideForm,rules:t.ruleValidate,"label-width":85,inline:""}},[o("FormItem",{attrs:{label:"入库日期：",prop:"date"}},[o("DatePicker",{staticClass:"zd-common-input-h38 zd-common-w150 zd-common-mr10",attrs:{editable:!1,type:"date",format:"yyyy-MM-dd",placeholder:"入库日期"},model:{value:t.provideForm.date,callback:function(e){t.$set(t.provideForm,"date",e)},expression:"provideForm.date"}})],1),t._v(" "),o("FormItem",{attrs:{label:"入库仓库：",prop:"warehouse"}},[o("Select",{staticClass:"zd-common-w150 zd-common-mr10",attrs:{placeholder:"选择入库仓库"},model:{value:t.provideForm.warehouse,callback:function(e){t.$set(t.provideForm,"warehouse",e)},expression:"provideForm.warehouse"}},t._l(t.warehouseArr,function(e){return o("Option",{key:e.id,attrs:{value:e.id}},[t._v(t._s(e.name))])}),1)],1),t._v(" "),o("FormItem",{attrs:{label:"入库类型：",prop:"type"}},[o("Select",{staticClass:"zd-common-w150 zd-common-mr10",attrs:{placeholder:"选择入库类型"},model:{value:t.provideForm.type,callback:function(e){t.$set(t.provideForm,"type",e)},expression:"provideForm.type"}},t._l(t.typeArr,function(e){return o("Option",{key:e.code,attrs:{value:e.code}},[t._v(t._s(e.name))])}),1)],1),t._v(" "),o("FormItem",{attrs:{label:"供应商：","label-width":60}},[o("Select",{staticClass:"zd-common-w150 zd-common-mr10",attrs:{placeholder:"全部供应商"},model:{value:t.provideForm.supplier,callback:function(e){t.$set(t.provideForm,"supplier",e)},expression:"provideForm.supplier"}},t._l(t.supplierArr,function(e){return o("Option",{key:e.id,attrs:{value:e.id}},[t._v(t._s(e.name))])}),1)],1),t._v(" "),o("FormItem",{attrs:{label:"购买人：","label-width":60}},[o("Select",{ref:"purchaser",staticClass:"zd-common-input-h38 zd-common-w150 zd-common-fl zd-common-mr10",attrs:{placeholder:"购买人",filterable:"",remote:"","remote-method":t.remoteMethod,loading:t.loading},model:{value:t.provideForm.purchaser,callback:function(e){t.$set(t.provideForm,"purchaser",e)},expression:"provideForm.purchaser"}},t._l(t.leaderArr,function(e){return o("Option",{key:e.id,attrs:{value:e.id}},[t._v(t._s(e.name))])}),1)],1)],1),t._v(" "),o("div",{staticClass:"zd-common-black-b zd-common-pt5 zd-common-pb5 zd-common-pl20"},[o("Button",{staticClass:"zd-common-mr10 zd-common-h32 zd-common-lh8",attrs:{type:"default"},on:{click:t.addGoodsHandle}},[t._v("\n      添加\n    ")]),t._v(" "),o("Button",{staticClass:"zd-common-mr10 zd-common-h32 zd-common-lh8",attrs:{type:"default"},on:{click:t.delRowHandle}},[t._v("\n      删除\n    ")]),t._v(" "),o("Button",{staticClass:"zd-common-mr10 zd-common-h32 zd-common-lh8",attrs:{type:"default"},on:{click:t.importHandle}},[t._v("\n      导入\n    ")]),t._v(" "),o("Input",{staticClass:"zd-cm-w220 zd-common-input-h32",attrs:{placeholder:"请输入物品编码，按Enter添加",maxlength:50},nativeOn:{keyup:function(e){return!e.type.indexOf("key")&&t._k(e.keyCode,"enter",13,e.key,"Enter")?null:t.getGoodsByCodeHandle(e)}},model:{value:t.code,callback:function(e){t.code=e},expression:"code"}})],1),t._v(" "),o("Form",{ref:"formGoodsData",staticClass:"zd-common-mt10",attrs:{model:t.formGoodsData}},[o("Table",{staticClass:"zd-common-overflow-v",attrs:{border:"",columns:t.goodsCols,data:t.formGoodsData.attrData,"show-summary":"","summary-method":t.handleSummary,"row-class-name":t.rowClassName},on:{"on-row-click":t.clickRowHandle},scopedSlots:t._u([{key:"number",fn:function(e){e.row;var r=e.index;return[o("Form-item",{staticClass:"zd-common-mt24",attrs:{prop:"attrData."+r+".number",rules:{required:!0,message:"不能为空",trigger:"change",type:"number"}}},[o("InputNumber",{attrs:{max:9999,min:1,precision:0,placeholder:"数量"},on:{"on-change":function(e){return t.getCurrIndex(r)}},model:{value:t.formGoodsData.attrData[r].number,callback:function(e){t.$set(t.formGoodsData.attrData[r],"number",e)},expression:"formGoodsData.attrData[index].number"}})],1)]}},{key:"price",fn:function(e){e.row;var r=e.index;return[o("Dropdown",{attrs:{placement:"bottom-start",trigger:"click"},on:{"on-click":t.setHistoryPrice}},[o("Form-item",{staticClass:"zd-common-mt24",attrs:{prop:"attrData."+r+".price",rules:{required:!0,message:"不能为空",trigger:"change",type:"number"}}},[o("InputNumber",{attrs:{min:.01,precision:2,placeholder:"价格"},on:{"on-change":function(e){return t.getCurrIndex(r)}},model:{value:t.formGoodsData.attrData[r].price,callback:function(e){t.$set(t.formGoodsData.attrData[r],"price",e)},expression:"formGoodsData.attrData[index].price"}})],1),t._v(" "),o("DropdownMenu",{attrs:{slot:"list"},slot:"list"},t._l(t.formGoodsData.attrData[r].priceList,function(e){return o("DropdownItem",{key:e,attrs:{name:e}},[t._v(t._s(e))])}),1)],1)]}},{key:"amount",fn:function(e){e.row;var r=e.index;return[o("Form-item",{staticClass:"zd-common-mt24"},[o("InputNumber",{attrs:{min:1,precision:2,placeholder:"金额"},model:{value:t.formGoodsData.attrData[r].amount,callback:function(e){t.$set(t.formGoodsData.attrData[r],"amount",e)},expression:"formGoodsData.attrData[index].amount"}})],1)]}}])})],1),t._v(" "),o("div",{staticClass:"zd-common-mt10 zd-common-clearFix"},[o("span",{staticClass:"zd-common-fl"},[t._v("制单人："+t._s(t.userName))]),t._v(" "),o("span",{staticClass:"zd-common-fl zd-common-ml20"},[t._v("制单日期："+t._s(t.date))])]),t._v(" "),o("Form",{ref:"provideRemarkForm",staticClass:"zd-common-mt20",attrs:{model:t.provideRemarkForm}},[o("FormItem",{staticClass:"zd-common-mb0",attrs:{label:"备注："}},[o("Input",{staticClass:"zd-common-fl",staticStyle:{width:"826px"},attrs:{placeholder:"备注",maxlength:100,type:"textarea",autosize:{minRows:5,maxRows:5}},model:{value:t.provideRemarkForm.remark,callback:function(e){t.$set(t.provideRemarkForm,"remark","string"==typeof e?e.trim():e)},expression:"provideRemarkForm.remark"}})],1)],1),t._v(" "),o("div",{staticClass:"zd-common-modal-footer zd-common-pt30",attrs:{slot:"footer"},slot:"footer"},[o("Button",{staticClass:"zd-common-mr35 zd-common-w100 zd-common-h32 zd-common-lh8",attrs:{type:"primary",loading:t.saveLoading},on:{click:t.handleSubmit}},[t.saveLoading?o("span",[t._v("正在保存...")]):o("span",[t._v("确定")])]),t._v(" "),o("Button",{staticClass:"zd-common-w100 zd-common-h32 zd-common-lh8",on:{click:t.toPutIn}},[t._v("取消")])],1),t._v(" "),o("Modal",{attrs:{"mask-closable":!1,width:1200},model:{value:t.addGoodsModal,callback:function(e){t.addGoodsModal=e},expression:"addGoodsModal"}},[o("h3",{staticClass:"zd-common-modal-header",attrs:{slot:"header"},slot:"header"},[o("span",[t._v("物品档案")])]),t._v(" "),o("add-goods",{ref:"child"}),t._v(" "),o("div",{staticClass:"zd-common-modal-footer zd-common-pt10",attrs:{slot:"footer"},slot:"footer"},[o("div",{staticClass:"zd-common-modal-footer zd-common-pt10",attrs:{slot:"footer"},slot:"footer"},[o("Button",{staticClass:"zd-common-mr35 zd-common-w100 zd-common-h32 zd-common-lh8",attrs:{type:"primary"},on:{click:t.saveGoodsHandle}},[t._v("确定")]),t._v(" "),o("Button",{staticClass:"zd-common-w100 zd-common-h32 zd-common-lh8",on:{click:function(e){t.addGoodsModal=!1}}},[t._v("取消")])],1)])],1),t._v(" "),o("Modal",{attrs:{"mask-closable":!1},model:{value:t.importModal,callback:function(e){t.importModal=e},expression:"importModal"}},[o("h3",{staticClass:"zd-common-modal-header",attrs:{slot:"header"},slot:"header"},[o("span",[t._v("导入物品档案")])]),t._v(" "),o("Form",{ref:"importForm",attrs:{model:t.importForm,rules:t.ruleValidate,"label-width":100,inline:""}},[o("FormItem",{attrs:{label:"上传文件：",prop:"fileName"}},[o("Upload",{ref:"upload",attrs:{action:"//",accept:"application/vnd.ms-excel,application/vnd.openxmlformats-officedocument.spreadsheetml.sheet","before-upload":t.handleUpload}},[o("Button",{attrs:{type:"primary",icon:"ios-cloud-upload-outline"}},[t._v("选择文件")])],1),t._v(" "),null!==t.importForm.file?o("div",[t._v(" "+t._s(t.importForm.file.name)+" ")]):t._e(),t._v(" "),o("a",{attrs:{href:t.serverPath+"/sr/storeroomData!downloadIntoTemplate.action"}},[t._v("下载模板")]),t._v(" "),o("input",{directives:[{name:"model",rawName:"v-model",value:t.importForm.fileName,expression:"importForm.fileName"}],attrs:{type:"text",hidden:""},domProps:{value:t.importForm.fileName},on:{input:function(e){e.target.composing||t.$set(t.importForm,"fileName",e.target.value)}}})],1)],1),t._v(" "),o("import-msg",{attrs:{importErrorMsg:t.importErrorMsg}}),t._v(" "),o("div",{staticClass:"zd-common-modal-footer zd-common-pt10",attrs:{slot:"footer"},slot:"footer"},[o("Button",{staticClass:"zd-common-mr35 zd-common-w100 zd-common-h32 zd-common-lh8",attrs:{type:"primary",loading:t.saveLoading},on:{click:function(e){return t.importSubmit("importForm")}}},[t.saveLoading?o("span",[t._v("正在保存...")]):o("span",[t._v("确定")])]),t._v(" "),o("Button",{staticClass:"zd-common-w100 zd-common-h32 zd-common-lh8",on:{click:function(e){t.importModal=!1}}},[t._v("取消")])],1)],1)],1)},[],!1,d,"data-v-3abdec7f",null);e.default=m.exports},pXtw:function(t,e){}});
//# sourceMappingURL=29.3cc13af6a9b3cbce271d.js.map