webpackJsonp([17],{VFIu:function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0});o("+RvV");var a={data:function(){var e=this;return{columns:[{type:"index",align:"center",title:"序号",width:65},{title:"名称",align:"center",key:"name"},{title:"盘点单号",align:"center",key:"orderNO"},{title:"仓库数量",align:"center",key:"warehouseNum",renderHeader:function(e,t){return e("div",[e("span",{},"仓库数量"),e("Tooltip",{props:{content:"已盘点完成仓库数量 / 需盘点仓库总数量","max-width":300}},[e("Icon",{props:{type:"ios-help-circle",size:16}})])])}},{title:"盘点物品数量",align:"center",key:"checkNumber",renderHeader:function(e,t){return e("div",[e("span",{},"盘点物品数量"),e("Tooltip",{props:{content:"已盘点物品数量 / 物品总量","max-width":300}},[e("Icon",{props:{type:"ios-help-circle",size:16}})])])}},{title:"盈亏物品数量",align:"center",key:"lossNumber",renderHeader:function(e,t){return e("div",[e("span",{},"盈亏物品数量"),e("Tooltip",{props:{content:"盘盈物品数量 / 盘亏物品数量","max-width":300}},[e("Icon",{props:{type:"ios-help-circle",size:16}})])])}},{title:"制单人",align:"center",key:"orderPerson"},{title:"制单日期",align:"center",key:"orderDate"},{title:"操作",align:"center",key:"action",width:230,render:function(t,o){return t("div",[t("Button",{props:{type:"primary",ghost:!0},style:{height:"28px",padding:"0 15px 1px",marginRight:"10px"},on:{click:function(){e.toCheckOrder(o.row.id)}}},"盘点"),t("Button",{props:{type:"primary",ghost:!0},style:{height:"28px",padding:"0 15px 1px",marginRight:"10px"},on:{click:function(){e.showAddCheck("edit",o.row.id,o.index)}}},"修改"),t("Button",{props:{type:"error",ghost:!0},style:{height:"28px",padding:"0 15px 1px"},on:{click:function(){e.showDelModal(o.row.id)}}},"删除")])}}],data:[],pageSize:10,pageNum:1,total:0,addCheckModal:!1,warehouseArr:[],date:"",checkForm:{name:"",warehouse:[]},ruleValidate:{name:[{required:!0,message:"不能为空",trigger:"blur"}],warehouse:[{required:!0,type:"array",message:"不能为空",trigger:"change"}]},saveLoading:!1,modalTitle:"添加盘点单",editId:"",storeRoomName:"",userName:"",delModal:!1,deleteForm:{reason:""},delId:"",dateOptions:this.dateRange,orderNO:"",startDate:"",endDate:"",selectLoading:!1}},created:function(){var e=this;this.getChargedStoreRoom().then(function(t){e.warehouseArr=t.data});var t=new Date;this.date=t.getFullYear()+"-"+this.fillZero(t.getMonth()+1)+"-"+this.fillZero(t.getDate()),this.getInventoryRecordPage(this.pageNum,this.pageSize,this.startDate,this.endDate,this.orderNO),this.$store.dispatch("getBaseInfo").then(function(t){e.userName=t.userName})},methods:{changeDate:function(e){this.startDate=e[0],this.endDate=e[1]},showAddCheck:function(e,t,o){"edit"===e?(this.modalTitle="修改盘点单",this.getEditInfo(t),this.checkForm.name=this.data[o].name,this.userName=this.data[o].orderPerson,this.date=this.data[o].orderDate):(this.modalTitle="添加盘点单",this.$refs.checkForm.resetFields()),this.editId=t,this.addCheckModal=!0},saveOrUpdateInventoryRecord:function(e,t,o){var a=this;BaseAxios({method:"post",url:"/sr/storeroomData!saveOrUpdateInventoryRecord.action",data:{name:e,warehouseIds:t,id:o}}).then(function(e){a.saveLoading=!1,a.addCheckModal=!1,a.getInventoryRecordPage(a.pageNum,a.pageSize,a.startDate,a.endDate,a.orderNO)}).catch(function(e){a.saveLoading=!1,a.addCheckModal=!1,a.postErrorTip("请求失败"),console.log(e)})},handleSubmit:function(e){var t=this;this.$refs[e].validate(function(e){e&&(t.saveLoading=!0,t.saveOrUpdateInventoryRecord(t.checkForm.name,t.checkForm.warehouse.join(","),t.editId))})},getEditInfo:function(e){var t=this;BaseAxios({method:"post",url:"/sr/storeroomData!getEditInfo.action",data:{id:e}}).then(function(e){var o=e.data;t.storeRoomName=o.storeRoomName}).catch(function(e){t.postErrorTip("请求失败"),console.log(e)})},showDelModal:function(e){this.delModal=!0,this.delId=e},handleDelSubmit:function(){this.saveLoading=!0,this.delModal=!1,this.deleteInventoryRecord(this.delId,this.deleteForm.reason)},deleteInventoryRecord:function(e,t){var o=this;BaseAxios({method:"post",url:"/sr/storeroomData!deleteInventoryRecord.action",data:{id:e,deleteCause:t}}).then(function(e){o.saveLoading=!1,o.getInventoryRecordPage(o.pageNum,o.pageSize,o.startDate,o.endDate,o.orderNO)}).catch(function(e){o.postErrorTip("请求失败"),console.log(e)})},toCheckOrder:function(e){this.$router.push({path:"/checkOrder/"+e})},getInventoryRecordPage:function(e,t,o,a,n){var s=this;this.data=[],BaseAxios({method:"post",url:"/sr/storeroomData!getInventoryRecordPage.action",data:{pageNum:e,pageSize:t,startDate:o,endDate:a,num:n}}).then(function(e){var t=e.data;t&&t.list.length>0&&t.list.map(function(e){s.data.push({id:e.id,name:e.name,orderNO:e.num,warehouseNum:e.storeroomInfo,checkNumber:e.storeroomGoodsInfo,lossNumber:e.storeroomGoodsInfoDetail,orderPerson:e.userName,orderDate:e.date})}),s.total=t.totalCount,s.selectLoading=!1}).catch(function(e){s.selectLoading=!1,s.postErrorTip("请求失败"),console.log(e)})},changePage:function(e){this.pageNum=e,this.getInventoryRecordPage(this.pageNum,this.pageSize,this.startDate,this.endDate,this.orderNO)},changePageSize:function(e){this.pageSize=e,this.getInventoryRecordPage(this.pageNum,this.pageSize,this.startDate,this.endDate,this.orderNO)},selectHandle:function(){this.selectLoading=!0,this.getInventoryRecordPage(this.pageNum,this.pageSize,this.startDate,this.endDate,this.orderNO)}},mounted:function(){}},n=o("W5g0");var s=function(e){o("hwtt")},r=Object(n.a)(a,function(){var e=this,t=e.$createElement,o=e._self._c||t;return o("div",{staticClass:"zd-common-component"},[o("div",{staticClass:"zd-common-clearFix"},[o("Button",{staticClass:"zd-common-fl zd-common-pl11 zd-common-pr11 zd-common-mr10",attrs:{type:"primary","custom-icon":"zd-common-icon-add"},on:{click:function(t){return e.showAddCheck("add","","")}}},[e._v("\n      盘点单\n    ")]),e._v(" "),o("div",{staticClass:"zd-common-fr"},[o("DatePicker",{staticClass:"zd-common-input-h38 zd-common-fl zd-common-mr10 zd-cm-w220",attrs:{editable:!1,type:"daterange",options:e.dateOptions,placeholder:"日期"},on:{"on-change":e.changeDate}}),e._v(" "),o("Input",{staticClass:"zd-common-input-h38 zd-common-w150 zd-common-fl zd-common-mr10",attrs:{maxlength:50,placeholder:"盘点单号"},model:{value:e.orderNO,callback:function(t){e.orderNO=t},expression:"orderNO"}}),e._v(" "),o("Button",{staticClass:"zd-common-fl",attrs:{type:"primary",loading:e.selectLoading},on:{click:e.selectHandle}},[e.selectLoading?o("span",[e._v("正在查询...")]):o("span",[e._v("查询")])])],1)],1),e._v(" "),o("div",{staticClass:"zd-common-mt16"},[o("Table",{ref:"currentRowTable",staticClass:"checkTable",attrs:{border:"",columns:e.columns,data:e.data}}),e._v(" "),o("div",{staticClass:"zd-common-tc zd-common-mt20"},[o("Page",{attrs:{total:e.total,current:e.pageNum,"page-size":e.pageSize,"show-sizer":"","show-elevator":"","show-total":""},on:{"on-change":e.changePage,"on-page-size-change":e.changePageSize}})],1)],1),e._v(" "),o("Modal",{attrs:{"mask-closable":!1},model:{value:e.addCheckModal,callback:function(t){e.addCheckModal=t},expression:"addCheckModal"}},[o("h3",{staticClass:"zd-common-modal-header",attrs:{slot:"header"},slot:"header"},[o("span",[e._v(e._s(e.modalTitle))])]),e._v(" "),o("Form",{ref:"checkForm",attrs:{model:e.checkForm,rules:e.ruleValidate,"label-width":100}},[o("FormItem",{attrs:{label:"名称：",prop:"name"}},[o("Input",{staticClass:"zd-common-w300",attrs:{placeholder:"请输入盘点名称",maxlength:30},model:{value:e.checkForm.name,callback:function(t){e.$set(e.checkForm,"name","string"==typeof t?t.trim():t)},expression:"checkForm.name"}})],1),e._v(" "),""===e.editId?o("FormItem",{attrs:{label:"盘点仓库：",prop:"warehouse"}},[o("Select",{staticClass:"zd-common-w300",attrs:{multiple:"",placeholder:"请选择盘点仓库"},model:{value:e.checkForm.warehouse,callback:function(t){e.$set(e.checkForm,"warehouse",t)},expression:"checkForm.warehouse"}},e._l(e.warehouseArr,function(t){return o("Option",{key:t.id,attrs:{value:t.id}},[e._v(e._s(t.name))])}),1)],1):o("p",{staticClass:"zd-common-mt24 zd-common-mb24"},[o("span",{staticClass:"zd-common-w100 zd-common-dib zd-common-tr zd-common-pr12"},[e._v("盘点仓库：")]),e._v(e._s(e.storeRoomName))]),e._v(" "),o("p",{staticClass:"zd-common-mt24 zd-common-mb24"},[o("span",{staticClass:"zd-common-w100 zd-common-dib zd-common-tr zd-common-pr12"},[e._v("制单人：")]),e._v(e._s(e.userName))]),e._v(" "),o("p",{staticClass:"zd-common-mt24 zd-common-mb24"},[o("span",{staticClass:"zd-common-w100 zd-common-dib zd-common-tr zd-common-pr12"},[e._v("制单日期：")]),e._v(e._s(e.date))])],1),e._v(" "),o("div",{staticClass:"zd-common-modal-footer zd-common-pt10",attrs:{slot:"footer"},slot:"footer"},[o("Button",{staticClass:"zd-common-mr35 zd-common-w100 zd-common-h32 zd-common-lh8",attrs:{type:"primary",loading:e.saveLoading},on:{click:function(t){return e.handleSubmit("checkForm")}}},[e.saveLoading?o("span",[e._v("正在保存...")]):o("span",[e._v("确定")])]),e._v(" "),o("Button",{staticClass:"zd-common-w100 zd-common-h32 zd-common-lh8",on:{click:function(t){e.addCheckModal=!1}}},[e._v("取消")])],1)],1),e._v(" "),o("Modal",{attrs:{"mask-closable":!1,width:590},model:{value:e.delModal,callback:function(t){e.delModal=t},expression:"delModal"}},[o("h3",{staticClass:"zd-common-modal-header",attrs:{slot:"header"},slot:"header"},[o("span",[e._v("删除入库单")])]),e._v(" "),o("Alert",{staticClass:"zd-common-warning-c",attrs:{type:"warning","show-icon":""}},[e._v("是否确认删除？")]),e._v(" "),o("Form",{ref:"deleteForm",attrs:{model:e.deleteForm}},[o("FormItem",{staticClass:"zd-common-mb0",attrs:{label:"删除原因："}},[o("Input",{staticClass:"zd-common-fl",attrs:{placeholder:"",maxlength:100,type:"textarea",autosize:{minRows:3,maxRows:3}},model:{value:e.deleteForm.reason,callback:function(t){e.$set(e.deleteForm,"reason","string"==typeof t?t.trim():t)},expression:"deleteForm.reason"}})],1)],1),e._v(" "),o("div",{staticClass:"zd-common-modal-footer zd-common-pt10",attrs:{slot:"footer"},slot:"footer"},[o("Button",{staticClass:"zd-common-mr35 zd-common-w100 zd-common-h32 zd-common-lh8",attrs:{type:"primary",loading:e.saveLoading},on:{click:e.handleDelSubmit}},[e.saveLoading?o("span",[e._v("正在保存...")]):o("span",[e._v("确定")])]),e._v(" "),o("Button",{staticClass:"zd-common-w100 zd-common-h32 zd-common-lh8",on:{click:function(t){e.delModal=!1}}},[e._v("取消")])],1)],1)],1)},[],!1,s,"data-v-bc0ea44e",null);t.default=r.exports},hwtt:function(e,t){}});
//# sourceMappingURL=17.3309a3c2c64b1f721d4f.js.map