webpackJsonp([14],{"3TGY":function(o,e){},hRPx:function(o,e,a){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var t=a("+RvV"),d={data:function(){var o=this;return{addModal:!1,addForm:{school:"",name:"",code:"",leader:[],leaderName:"",address:""},ruleValidate:{school:[{required:!0,message:"不能为空",trigger:"change"}],name:[{required:!0,message:"不能为空",trigger:"blur"}],code:[{required:!0,validator:function(e,a,d){""===a?d(new Error("不能为空")):t.c.regCode.test(a)?BaseAxios({method:"post",url:"/sr/storeroomData!checkStoreroomCodeRepeat.action",data:{code:a,id:o.editId}}).then(function(o){o.data&&d(new Error("编码重复")),d()}).catch(function(o){d(new Error("验证失败")),console.log(o)}):d(new Error(t.c.regCodeMsg))},trigger:"blur"}],leader:[{required:!0,type:"array",message:"不能为空",trigger:"blur"}]},modalTitle:"添加仓库档案",leaderArr:[],loading:!1,columns:[{type:"index",align:"center",title:"序号",width:65},{title:"所属校区",align:"center",key:"school"},{title:"仓库名称",align:"center",key:"name"},{title:"仓库编码",align:"center",key:"code"},{title:"负责人",align:"center",key:"leader"},{title:"仓库地址",align:"center",key:"address"},{title:"操作",align:"center",key:"action",width:160,render:function(e,a){return e("div",[e("Button",{props:{type:"primary",ghost:!0},style:{height:"28px",padding:"0 15px 1px",marginRight:"10px"},on:{click:function(){o.showModifyModal(a.row.id)}}},"编辑"),e("Button",{props:{type:"error",ghost:!0},style:{height:"28px",padding:"0 15px 1px"},on:{click:function(){o.showDelModal(a.row.id)}}},"删除")])}}],data:[],pageSize:10,pageNum:1,total:0,selectLoading:!1,allSchoolArr:[],schoolName:"",warehouseArr:[],warehouseName:"",leader:"",saveLoading:!1,editId:"",delModal:!1}},created:function(){var o=this;this.getAllSchool().then(function(e){o.allSchoolArr=e.data}),this.getStoreroomList(this.schoolName,this.warehouseName,this.leader)},methods:{transCode:function(){this.addForm.code=Object(t.b)(this.addForm.name)},changeSchool:function(o){this.getAllWarehouse(o)},remoteMethod:function(o){var e=this;this.selectLeader(o).then(function(o){e.leaderArr=o.data})},showAddModal:function(){this.addModal=!0,this.modalTitle="添加仓库档案",this.$refs.addForm.resetFields()},saveOrUpdateStoreroom:function(o,e,a,t,d,r){var s=this,l={};l["storeroom.school.id"]=o,l["storeroom.name"]=e,l["storeroom.code"]=a,l.userIds=t,""!==d&&(l["storeroom.classroom.id"]=d),l["storeroom.id"]=r,BaseAxios({method:"post",url:"/sr/storeroomData!saveOrUpdateStoreroom.action",data:l}).then(function(o){s.saveLoading=!1,s.addModal=!1,s.getStoreroomList(s.schoolName,s.warehouseName,s.leader),s.postSuccessTip("保存成功")}).catch(function(o){s.saveLoading=!1,s.addModal=!1,s.postErrorTip("请求失败"),console.log(o)})},handleSubmit:function(o){var e=this;this.$refs[o].validate(function(o){o&&(e.saveLoading=!0,e.saveOrUpdateStoreroom(e.addForm.school,e.addForm.name,e.addForm.code,e.addForm.leader.join(","),e.addForm.address,e.editId))})},getStoreroomList:function(o,e,a){var t=this;this.data=[],BaseAxios({method:"post",url:"/sr/storeroomData!getStoreroomsByParam.action",data:{schoolId:o,name:e,userName:a}}).then(function(o){var e=o.data;e&&e.length>0&&e.map(function(o){t.data.push({id:o.id,school:o.schoolName,name:o.name,code:o.code,leader:o.userNames,address:o.classroom})}),t.selectLoading=!1}).catch(function(o){t.selectLoading=!1,t.postErrorTip("请求失败"),console.log(o)})},getStoreroomInfo:function(o){var e=this;BaseAxios({method:"post",url:"/sr/storeroomData!getStoreroomInfo.action",data:{id:o}}).then(function(o){var a=o.data;e.addForm.school=a.schoolId,e.addForm.name=a.name,e.addForm.code=a.code,e.addForm.leader=a.userIds.split(","),e.addForm.leaderName=a.userNames.split(","),e.addForm.address=a.classroomId,e.editId=a.id,e.addForm.leader.map(function(o,a){e.leaderArr.push({id:o,name:e.addForm.leaderName[a]})})}).catch(function(o){e.postErrorTip("请求失败"),console.log(o)})},showModifyModal:function(o){this.addModal=!0,this.$refs.addForm.resetFields(),this.modalTitle="编辑仓库档案",this.getStoreroomInfo(o)},showDelModal:function(o){this.editId=o,this.delModal=!0},deleteStoreroom:function(o){var e=this;BaseAxios({method:"post",url:"/sr/storeroomData!deleteStoreroom.action",data:{id:o}}).then(function(o){""!==o.data?e.postWarningTip(o.data):e.getStoreroomList(e.schoolName,e.warehouseName,e.leader),e.saveLoading=!1}).catch(function(o){e.saveLoading=!1,e.postErrorTip("请求失败"),console.log(o)})},confirmDelete:function(){this.saveLoading=!0,this.delModal=!1,this.deleteStoreroom(this.editId)},selectHandle:function(){this.selectLoading=!0,this.getStoreroomList(this.schoolName,this.warehouseName,this.leader)}},mounted:function(){}},r=a("W5g0");var s=function(o){a("3TGY")},l=Object(r.a)(d,function(){var o=this,e=o.$createElement,a=o._self._c||e;return a("div",{staticClass:"zd-common-component"},[a("div",{staticClass:"zd-common-clearFix"},[a("Button",{staticClass:"zd-common-fl zd-common-pl11 zd-common-pr11 zd-common-mr10",attrs:{type:"primary","custom-icon":"zd-common-icon-add"},on:{click:o.showAddModal}},[o._v("\n      仓库档案\n    ")]),o._v(" "),a("div",{staticClass:"zd-common-fr"},[a("Select",{staticClass:"zd-common-input-h38 zd-common-w200 zd-common-fl zd-common-mr10",attrs:{placeholder:"全部学校",clearable:""},model:{value:o.schoolName,callback:function(e){o.schoolName=e},expression:"schoolName"}},o._l(o.allSchoolArr,function(e){return a("Option",{key:e.id,attrs:{value:e.id}},[o._v(o._s(e.name))])}),1),o._v(" "),a("Input",{staticClass:"zd-common-input-h38 zd-common-w200 zd-common-fl zd-common-mr10",attrs:{placeholder:"仓库名称"},model:{value:o.warehouseName,callback:function(e){o.warehouseName=e},expression:"warehouseName"}}),o._v(" "),a("Select",{staticClass:"zd-common-input-h38 zd-common-w200 zd-common-fl zd-common-mr10",attrs:{placeholder:"负责人",filterable:"",remote:"","remote-method":o.remoteMethod,loading:o.loading},model:{value:o.leader,callback:function(e){o.leader=e},expression:"leader"}},o._l(o.leaderArr,function(e){return a("Option",{key:e.id,attrs:{value:e.id}},[o._v(o._s(e.name))])}),1),o._v(" "),a("Button",{staticClass:"zd-common-fl",attrs:{type:"primary",loading:o.selectLoading},on:{click:o.selectHandle}},[o.selectLoading?a("span",[o._v("正在查询...")]):a("span",[o._v("查询")])])],1)],1),o._v(" "),a("div",{staticClass:"zd-common-mt16"},[a("Table",{ref:"currentRowTable",attrs:{border:"",columns:o.columns,data:o.data}})],1),o._v(" "),a("Modal",{staticClass:"zd-cm-form",attrs:{"mask-closable":!1},model:{value:o.addModal,callback:function(e){o.addModal=e},expression:"addModal"}},[a("h3",{staticClass:"zd-common-modal-header",attrs:{slot:"header"},slot:"header"},[a("span",[o._v(o._s(o.modalTitle))])]),o._v(" "),a("Form",{ref:"addForm",attrs:{model:o.addForm,rules:o.ruleValidate,"label-width":100}},[a("FormItem",{attrs:{label:"所属校区：",prop:"school"}},[a("Select",{staticClass:"zd-common-w300",attrs:{placeholder:"请选择学校"},on:{"on-change":o.changeSchool},model:{value:o.addForm.school,callback:function(e){o.$set(o.addForm,"school",e)},expression:"addForm.school"}},o._l(o.allSchoolArr,function(e){return a("Option",{key:e.id,attrs:{value:e.id}},[o._v(o._s(e.name))])}),1)],1),o._v(" "),a("FormItem",{attrs:{label:"仓库名称：",prop:"name"}},[a("Input",{staticClass:"zd-common-w300",attrs:{placeholder:"请输入仓库名称",maxlength:30},on:{"on-blur":o.transCode},model:{value:o.addForm.name,callback:function(e){o.$set(o.addForm,"name","string"==typeof e?e.trim():e)},expression:"addForm.name"}})],1),o._v(" "),a("FormItem",{attrs:{label:"仓库编码：",prop:"code"}},[a("Input",{staticClass:"zd-common-w300",attrs:{placeholder:"请输入仓库编码",maxlength:30},model:{value:o.addForm.code,callback:function(e){o.$set(o.addForm,"code","string"==typeof e?e.trim():e)},expression:"addForm.code"}})],1),o._v(" "),a("FormItem",{attrs:{label:"负责人：",prop:"leader"}},[a("Select",{staticClass:"zd-common-w300",attrs:{placeholder:"请输入本仓库负责人",filterable:"",remote:"",multiple:"","remote-method":o.remoteMethod,loading:o.loading},model:{value:o.addForm.leader,callback:function(e){o.$set(o.addForm,"leader",e)},expression:"addForm.leader"}},o._l(o.leaderArr,function(e,t){return a("Option",{key:e.id,attrs:{value:e.id}},[o._v(o._s(e.name))])}),1)],1),o._v(" "),a("FormItem",{attrs:{label:"仓库地址："}},[a("Select",{staticClass:"zd-common-w300",attrs:{placeholder:"请选择仓库地址"},model:{value:o.addForm.address,callback:function(e){o.$set(o.addForm,"address",e)},expression:"addForm.address"}},o._l(o.warehouseArr,function(e){return a("Option",{key:e.id,attrs:{value:e.id}},[o._v(o._s(e.name))])}),1)],1)],1),o._v(" "),a("div",{staticClass:"zd-common-modal-footer zd-common-pt6",attrs:{slot:"footer"},slot:"footer"},[a("Button",{staticClass:"zd-common-mr35 zd-common-w100 zd-common-h32 zd-common-lh8",attrs:{type:"primary",loading:o.saveLoading},on:{click:function(e){return o.handleSubmit("addForm")}}},[o.saveLoading?a("span",[o._v("正在保存...")]):a("span",[o._v("确定")])]),o._v(" "),a("Button",{staticClass:"zd-common-w100 zd-common-h32 zd-common-lh8",on:{click:function(e){o.addModal=!1}}},[o._v("取消")])],1)],1),o._v(" "),a("Modal",{attrs:{"mask-closable":!1,width:360},model:{value:o.delModal,callback:function(e){o.delModal=e},expression:"delModal"}},[a("h3",{attrs:{slot:"header"},slot:"header"}),o._v(" "),a("div",{staticClass:"zd-common-tc"},[a("div",{staticClass:"zd-common-modal-waring zd-common-auto"}),o._v(" "),a("p",{staticClass:"zd-common-primary-c zd-common-font-size-large zd-common-mt15"},[o._v("是否确认删除？")])]),o._v(" "),a("div",{staticClass:"zd-common-modal-footer zd-common-pt10",attrs:{slot:"footer"},slot:"footer"},[a("Button",{staticClass:"zd-common-mr24 zd-common-w100 zd-common-h32 zd-common-lh8",attrs:{type:"primary",loading:o.saveLoading},on:{click:o.confirmDelete}},[o.saveLoading?a("span",[o._v("正在删除...")]):a("span",[o._v("确定")])]),o._v(" "),a("Button",{staticClass:"zd-common-w100 zd-common-h32 zd-common-lh8",on:{click:function(e){o.delModal=!1}}},[o._v("取消")])],1)])],1)},[],!1,s,"data-v-d6be5e7a",null);e.default=l.exports}});
//# sourceMappingURL=14.110f02d8e9f9c3146287.js.map