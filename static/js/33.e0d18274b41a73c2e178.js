webpackJsonp([33],{"5s4v":function(t,e,o){"use strict";Object.defineProperty(e,"__esModule",{value:!0});o("+RvV");var a={data:function(){var t=this;return{columns:[{type:"index",align:"center",title:"序号",width:65},{title:"出库单号",align:"center",key:"putInOrder"},{title:"出库日期",align:"center",key:"putInDate"},{title:"出库类型",align:"center",key:"putInType"},{title:"出库仓库",align:"center",key:"warehouse"},{title:"领用人",align:"center",key:"user"},{title:"物品数量",align:"center",key:"number"},{title:"制单人",align:"center",key:"orderPerson"},{title:"制单日期",align:"center",key:"orderDate"},{title:"操作",align:"center",key:"action",width:300,render:function(e,o){return o.row.signFlag?e("div",[e("Button",{props:{type:"primary",ghost:!0},style:{height:"28px",padding:"0 15px 1px",marginRight:"10px"},on:{click:function(){t.showViewModal(o.row.id)}}},"查看"),e("Button",{props:{type:"primary",ghost:!0},style:{height:"28px",padding:"0 15px 1px",marginRight:"10px"},on:{click:function(){t.showSignModal(o.index)}}},"签字"),e("Button",{props:{type:"primary",ghost:!0},style:{height:"28px",padding:"0 15px 1px",marginRight:"10px"},on:{click:function(){t.showModifyModal(o.row.id)}}},"修改"),e("Button",{props:{type:"error",ghost:!0},style:{height:"28px",padding:"0 15px 1px"},on:{click:function(){t.showDelModal(o.row.id)}}},"删除")]):e("div",[e("Button",{props:{type:"primary",ghost:!0},style:{height:"28px",padding:"0 15px 1px"},on:{click:function(){t.showViewModal(o.row.id)}}},"查看")])}}],data:[],pageSize:10,pageNum:1,total:0,saveLoading:!1,goodsCols:[{type:"index",title:"序号",align:"center",width:65},{title:"物品名称",align:"center",key:"name"},{title:"物品编码",align:"center",key:"code"},{title:"物品分类",align:"center",key:"classify"},{title:"品牌",align:"center",key:"brand"},{title:"规格/型号",align:"center",key:"model"},{title:"单位",align:"center",key:"unit",width:65},{title:"出库数量",align:"center",key:"number"},{title:"金额",align:"center",key:"amount"}],goodsData:[{name:"电池",code:"xm5hdc",classify:"办公",brand:"南孚",model:"p34",unit:"个",number:3,amount:360}],viewModal:!1,allDetail:{},delModal:!1,deleteForm:{reason:""},delId:"",dateOptions:this.dateRange,startDate:"",endDate:"",typeArr:[],type:"",warehouseArr:[],warehouse:"",orderNO:"",leader:"",leaderArr:[],loading:!1,selectLoading:!1,signId:"",signModal:!1,signOrderNO:"",visible:!1,uploadPicUrl:"",signForm:{uploadId:""},ruleValidate:{uploadId:[{required:!0,message:"请选择文件",trigger:"blur"}]},uploadList:[]}},created:function(){var t=this;this.getOutWarehouseRecordPage(this.pageNum,this.pageSize,this.startDate,this.endDate,this.type,this.warehouse,this.orderNO,this.leader),this.getOutKindList().then(function(e){t.typeArr=e.data}),this.getChargedStoreRoom().then(function(e){t.warehouseArr=e.data})},methods:{printHandle:function(){this.$print(this.$refs.print)},remoteMethod:function(t){var e=this;this.selectLeader(t).then(function(t){e.leaderArr=t.data})},changeDate:function(t){this.startDate=t[0],this.endDate=t[1]},toAddOrder:function(){this.$router.push({path:"/addOutOrder"})},showViewModal:function(t){this.viewModal=!0,this.getOutWarehouseRecordInfo(t)},getOutWarehouseRecordInfo:function(t){var e=this;this.goodsData=[],BaseAxios({method:"post",url:"/sr/storeroomData!getOutWarehouseRecordInfo.action",data:{id:t}}).then(function(t){var o=t.data;e.allDetail=o,o.goodsList.map(function(t){e.goodsData.push({name:t.goodsInfoName,code:t.code,classify:t.goodsKindName,brand:t.brand,model:t.size,unit:t.unit,number:t.goodsNum,amount:t.totalPrice})})}).catch(function(t){e.postErrorTip("请求失败"),console.log(t)})},showModifyModal:function(t){this.$router.push({path:"/editOutOrder/"+t})},handleSummary:function(t){var e=t.columns,o=t.data,a={};return e.forEach(function(t,e){var s=t.key;if(0!==e){var n=o.map(function(t){return Number(t[s])});if(n.every(function(t){return isNaN(t)})||7!==e&&8!==e)a[s]={key:s,value:""};else{var i=n.reduce(function(t,e){var o=Number(e);return isNaN(o)?t:t+e},0);a[s]={key:s,value:i}}}else a[s]={key:s,value:"合计"}}),a},showDelModal:function(t){this.delModal=!0,this.delId=t,this.deleteForm.reason=""},deleteOutWarehouseRecord:function(t,e){var o=this;BaseAxios({method:"post",url:"/sr/storeroomData!deleteOutWarehouseRecord.action",data:{id:t,deleteCause:e}}).then(function(t){var e=t.data;""!==e&&o.postWarningTip(e),o.saveLoading=!1,o.getOutWarehouseRecordPage(o.pageNum,o.pageSize,o.startDate,o.endDate,o.type,o.warehouse,o.orderNO,o.leader)}).catch(function(t){o.saveLoading=!1,o.postErrorTip("请求失败"),console.log(t)})},handleSubmit:function(){this.saveLoading=!0,this.delModal=!1,this.deleteOutWarehouseRecord(this.delId,this.deleteForm.reason)},handleSuccess:function(t,e){this.signForm.uploadId=t.id,e.url=this.serverPath+"/sr/storeroomData!showTempPic.action?attachmentId="+t.id,this.uploadList=[e],this.$refs.signForm.validate()},handleFormatError:function(t){this.postWarningTip("图片格式错误")},handleMaxSize:function(t){this.postWarningTip("最多上传2M大小的图片")},showSignModal:function(t){this.signForm.uploadId="",this.signModal=!0,this.signOrderNO=this.data[t].putInOrder,this.signId=this.data[t].id,this.uploadList=[]},handleView:function(t){this.uploadPicUrl=t,this.visible=!0},handleRemove:function(){this.uploadList=[],this.signForm.uploadId=""},signSubmit:function(t){var e=this;this.$refs[t].validate(function(t){t&&(e.signModal=!1,e.saveLoading=!0,e.signOutWarehouseRecord(e.signId,e.signForm.uploadId))})},signOutWarehouseRecord:function(t,e){var o=this;BaseAxios({method:"post",url:"/sr/storeroomData!signOutWarehouseRecord.action",data:{id:t,attIds:e}}).then(function(t){o.saveLoading=!1,o.getOutWarehouseRecordPage(o.pageNum,o.pageSize,o.startDate,o.endDate,o.type,o.warehouse,o.orderNO,o.leader)}).catch(function(t){o.saveLoading=!1,o.postErrorTip("请求失败"),console.log(t)})},getOutWarehouseRecordPage:function(t,e,o,a,s,n,i,r){var d=this;this.data=[],BaseAxios({method:"post",url:"/sr/storeroomData!getOutWarehouseRecordPage.action",data:{pageNum:t,pageSize:e,startDate:o,endDate:a,kindCode:s,storeroomId:n,num:i,userId:r}}).then(function(t){var e=t.data;e&&e.list.length>0&&e.list.map(function(t){d.data.push({id:t.id,putInOrder:t.num,putInDate:t.date,putInType:t.kind,warehouse:t.warehouseName,user:t.buyserName,number:t.goodsNum,orderPerson:t.user,orderDate:t.productDate,signFlag:t.signFlag})}),d.total=e.totalCount,d.selectLoading=!1}).catch(function(t){d.selectLoading=!1,d.postErrorTip("请求失败"),console.log(t)})},changePage:function(t){this.pageNum=t,this.getOutWarehouseRecordPage(this.pageNum,this.pageSize,this.startDate,this.endDate,this.type,this.warehouse,this.orderNO,this.leader)},changePageSize:function(t){this.pageSize=t,this.getOutWarehouseRecordPage(this.pageNum,this.pageSize,this.startDate,this.endDate,this.type,this.warehouse,this.orderNO,this.leader)},selectHandle:function(){this.selectLoading=!0,this.getOutWarehouseRecordPage(this.pageNum,this.pageSize,this.startDate,this.endDate,this.type,this.warehouse,this.orderNO,this.leader)}},mounted:function(){this.uploadList=this.$refs.upload.fileList}},s=o("W5g0");var n=function(t){o("Mkiq")},i=Object(s.a)(a,function(){var t=this,e=t.$createElement,o=t._self._c||e;return o("div",{staticClass:"zd-common-component"},[o("div",{staticClass:"zd-common-clearFix"},[o("Button",{staticClass:"zd-common-fl zd-common-pl11 zd-common-pr11 zd-common-mr10 zd-cm-res-fl",attrs:{type:"primary","custom-icon":"zd-common-icon-add"},on:{click:t.toAddOrder}},[t._v("\n      出库单\n    ")]),t._v(" "),o("div",{staticClass:"zd-common-fr zd-cm-res-fr"},[o("DatePicker",{staticClass:"zd-common-input-h38 zd-common-fl zd-common-mr10 zd-cm-w220",attrs:{editable:!1,type:"daterange",options:t.dateOptions,placeholder:"日期"},on:{"on-change":t.changeDate}}),t._v(" "),o("Select",{staticClass:"zd-common-input-h38 zd-common-w150 zd-common-fl zd-common-mr10",attrs:{clearable:"",placeholder:"全部出库类型"},model:{value:t.type,callback:function(e){t.type=e},expression:"type"}},t._l(t.typeArr,function(e){return o("Option",{key:e.code,attrs:{value:e.code}},[t._v(t._s(e.name))])}),1),t._v(" "),o("Select",{staticClass:"zd-common-input-h38 zd-common-w150 zd-common-fl zd-common-mr10",attrs:{clearable:"",placeholder:"全部出库仓库"},model:{value:t.warehouse,callback:function(e){t.warehouse=e},expression:"warehouse"}},t._l(t.warehouseArr,function(e){return o("Option",{key:e.id,attrs:{value:e.id}},[t._v(t._s(e.name))])}),1),t._v(" "),o("Input",{staticClass:"zd-common-input-h38 zd-common-w150 zd-common-fl zd-common-mr10",attrs:{maxlength:50,placeholder:"出库单号"},model:{value:t.orderNO,callback:function(e){t.orderNO=e},expression:"orderNO"}}),t._v(" "),o("Select",{ref:"leader",staticClass:"zd-common-input-h38 zd-common-w150 zd-common-fl zd-common-mr10",attrs:{placeholder:"领用人",filterable:"",remote:"","remote-method":t.remoteMethod,loading:t.loading},model:{value:t.leader,callback:function(e){t.leader=e},expression:"leader"}},t._l(t.leaderArr,function(e){return o("Option",{key:e.id,attrs:{value:e.id}},[t._v(t._s(e.name))])}),1),t._v(" "),o("Button",{staticClass:"zd-common-fl",attrs:{type:"primary",loading:t.selectLoading},on:{click:t.selectHandle}},[t.selectLoading?o("span",[t._v("正在查询...")]):o("span",[t._v("查询")])])],1)],1),t._v(" "),o("div",{staticClass:"zd-common-mt16"},[o("Table",{ref:"currentRowTable",attrs:{border:"",columns:t.columns,data:t.data}}),t._v(" "),o("div",{staticClass:"zd-common-tc zd-common-mt20"},[o("Page",{attrs:{total:t.total,current:t.pageNum,"page-size":t.pageSize,"show-sizer":"","show-elevator":"","show-total":""},on:{"on-change":t.changePage,"on-page-size-change":t.changePageSize}})],1)],1),t._v(" "),o("Modal",{staticClass:"print",attrs:{"mask-closable":!1,width:1100},model:{value:t.viewModal,callback:function(e){t.viewModal=e},expression:"viewModal"}},[o("h3",{staticClass:"zd-common-modal-header",attrs:{slot:"header"},slot:"header"},[o("span",[t._v("查看出库单")])]),t._v(" "),o("div",{staticClass:"zd-common-clearFix"},[o("span",{staticClass:"zd-common-fl zd-common-mr14"},[t._v("出库单号："),o("span",{staticClass:"zd-common-font-weight"},[t._v(t._s(t.allDetail.num))])]),t._v(" "),o("span",{staticClass:"zd-common-fl zd-common-mr14"},[t._v("出库日期："),o("span",{staticClass:"zd-common-font-weight"},[t._v(t._s(t.allDetail.date))])]),t._v(" "),o("span",{staticClass:"zd-common-fl zd-common-mr14"},[t._v("出库仓库："),o("span",{staticClass:"zd-common-font-weight"},[t._v(t._s(t.allDetail.warehouseName))])]),t._v(" "),o("br"),t._v(" "),o("span",{staticClass:"zd-common-fl zd-common-mr14 zd-common-mt10"},[t._v("出库类型："),o("span",{staticClass:"zd-common-font-weight"},[t._v(t._s(t.allDetail.kindCode))])]),t._v(" "),o("span",{staticClass:"zd-common-fl zd-common-mr14 zd-common-mt10"},[t._v("部门："),o("span",{staticClass:"zd-common-font-weight"},[t._v(t._s(t.allDetail.departmentName))])]),t._v(" "),o("span",{staticClass:"zd-common-fl zd-common-mr14 zd-common-mt10"},[t._v("领用人："),o("span",{staticClass:"zd-common-font-weight"},[t._v(t._s(t.allDetail.buyserName))])])]),t._v(" "),o("div",{staticClass:"zd-common-h300 zd-common-mt10"},[o("vue-scroll",[o("Table",{attrs:{border:"",columns:t.goodsCols,data:t.goodsData,"summary-method":t.handleSummary,"show-summary":""}})],1)],1),t._v(" "),o("div",{staticClass:"zd-common-mt10 zd-common-clearFix"},[o("span",{staticClass:"zd-common-fl"},[t._v("制单人："+t._s(t.allDetail.userName))]),o("span",{staticClass:"zd-common-fl zd-common-ml20"},[t._v("制单日期："+t._s(t.allDetail.productDate))])]),t._v(" "),o("div",{staticClass:"zd-common-mt10 zd-common-clearFix"},[o("span",{staticClass:"zd-common-clearFix"},[o("span",{staticClass:"zd-common-fl"},[t._v("备注：")]),o("span",{staticClass:"zd-common-fl zd-cm-remark"},[t._v(t._s(t.allDetail.note))])])]),t._v(" "),o("div",{staticClass:"zd-common-modal-footer zd-common-pt10",attrs:{slot:"footer"},slot:"footer"},[o("Button",{staticClass:"zd-common-mr35 zd-common-w100 zd-common-h32 zd-common-lh8",attrs:{type:"primary"},on:{click:t.printHandle}},[t._v("打印")]),t._v(" "),o("Button",{staticClass:"zd-common-w100 zd-common-h32 zd-common-lh8",on:{click:function(e){t.viewModal=!1}}},[t._v("取消")])],1)]),t._v(" "),o("Modal",{attrs:{"mask-closable":!1,width:590},model:{value:t.delModal,callback:function(e){t.delModal=e},expression:"delModal"}},[o("h3",{staticClass:"zd-common-modal-header",attrs:{slot:"header"},slot:"header"},[o("span",[t._v("删除出库单")])]),t._v(" "),o("Alert",{staticClass:"zd-common-warning-c",attrs:{type:"warning","show-icon":""}},[t._v("删除出库单将同步删除该出库单中所有已出库物品，导致数据统计错误，请谨慎操作！")]),t._v(" "),o("Form",{ref:"deleteForm",attrs:{model:t.deleteForm}},[o("FormItem",{staticClass:"zd-common-mb0",attrs:{label:"删除原因："}},[o("Input",{staticClass:"zd-common-fl",attrs:{placeholder:"",maxlength:100,type:"textarea",autosize:{minRows:3,maxRows:3}},model:{value:t.deleteForm.reason,callback:function(e){t.$set(t.deleteForm,"reason","string"==typeof e?e.trim():e)},expression:"deleteForm.reason"}})],1)],1),t._v(" "),o("div",{staticClass:"zd-common-modal-footer zd-common-pt10",attrs:{slot:"footer"},slot:"footer"},[o("Button",{staticClass:"zd-common-mr35 zd-common-w100 zd-common-h32 zd-common-lh8",attrs:{type:"primary",loading:t.saveLoading},on:{click:t.handleSubmit}},[t.saveLoading?o("span",[t._v("正在保存...")]):o("span",[t._v("确定")])]),t._v(" "),o("Button",{staticClass:"zd-common-w100 zd-common-h32 zd-common-lh8",on:{click:function(e){t.delModal=!1}}},[t._v("取消")])],1)],1),t._v(" "),o("Modal",{attrs:{"mask-closable":!1,width:590},model:{value:t.signModal,callback:function(e){t.signModal=e},expression:"signModal"}},[o("h3",{staticClass:"zd-common-modal-header",attrs:{slot:"header"},slot:"header"},[o("span",[t._v("签字-"+t._s(t.signOrderNO))])]),t._v(" "),o("Form",{ref:"signForm",staticClass:"zd-common-tc",attrs:{model:t.signForm,rules:t.ruleValidate,"label-width":0}},[o("FormItem",{attrs:{label:"",prop:"uploadId"}},[t._l(t.uploadList,function(e){return o("div",{staticClass:"demo-upload-list zd-common-w150"},["finished"===e.status?[o("img",{attrs:{src:e.url}}),t._v(" "),o("div",{staticClass:"demo-upload-list-cover"},[o("Icon",{attrs:{type:"ios-eye-outline"},nativeOn:{click:function(o){return t.handleView(e.url)}}}),t._v(" "),o("Icon",{attrs:{type:"ios-trash-outline"},nativeOn:{click:function(e){return t.handleRemove(e)}}})],1)]:[e.showProgress?o("Progress",{attrs:{percent:e.percentage,"hide-info":""}}):t._e()]],2)}),t._v(" "),o("Upload",{ref:"upload",staticClass:"zd-common-w150 zd-common-auto",attrs:{name:"filedata","show-upload-list":!1,format:["jpg","jpeg","png"],type:"drag",action:t.serverPath+"/component/attachment!saveUploadFile2.action","max-size":2048,"on-success":t.handleSuccess,"on-format-error":t.handleFormatError,"on-exceeded-size":t.handleMaxSize}},[o("Button",{staticClass:"zd-common-w150",attrs:{type:"primary"}},[t._v("上传签字图片")])],1),t._v(" "),o("p",{staticClass:"zd-common-fs12 zd-common-des-font-c"},[t._v("允许上传png、jpg、jpeg格式图片")]),t._v(" "),o("input",{directives:[{name:"model",rawName:"v-model",value:t.signForm.uploadId,expression:"signForm.uploadId"}],attrs:{type:"text",hidden:""},domProps:{value:t.signForm.uploadId},on:{input:function(e){e.target.composing||t.$set(t.signForm,"uploadId",e.target.value)}}}),t._v(" "),o("Modal",{attrs:{width:60},model:{value:t.visible,callback:function(e){t.visible=e},expression:"visible"}},[o("h3",{staticClass:"zd-common-modal-header",attrs:{slot:"header"},slot:"header"},[o("span",[t._v("预览签字")])]),t._v(" "),o("vue-scroll",[o("div",{staticClass:"zd-common-font-size-base zd-common-lh30 zd-common-tc zd-common-h500"},[t.visible?o("img",{staticStyle:{"max-width":"100%"},attrs:{src:t.uploadPicUrl}}):t._e()])]),t._v(" "),o("div",{staticClass:"zd-common-modal-footer zd-common-pt0",attrs:{slot:"footer"},slot:"footer"})],1)],2)],1),t._v(" "),o("div",{staticClass:"zd-common-modal-footer zd-common-pt0",attrs:{slot:"footer"},slot:"footer"},[o("Button",{staticClass:"zd-common-mr35 zd-common-w100 zd-common-h32 zd-common-lh8",attrs:{type:"primary",loading:t.saveLoading},on:{click:function(e){return t.signSubmit("signForm")}}},[t.saveLoading?o("span",[t._v("正在保存...")]):o("span",[t._v("确定")])]),t._v(" "),o("Button",{staticClass:"zd-common-w100 zd-common-h32 zd-common-lh8",on:{click:function(e){t.signModal=!1}}},[t._v("取消")])],1)],1)],1)},[],!1,n,"data-v-19fd7928",null);e.default=i.exports},Mkiq:function(t,e){}});
//# sourceMappingURL=33.e0d18274b41a73c2e178.js.map