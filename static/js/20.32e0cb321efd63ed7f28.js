webpackJsonp([20],{"8DFd":function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var c=o("fYFQ"),a=o.n(c),n=(o("Kmkn"),{components:{Treeselect:a.a},data:function(){return{saveLoading:!1,isSave:!1,setForm:{isConfirmSwitch:!1,generalCheckSwitch:!1,departCheckSwitch:!1,generalCheck:[],departCheck:null,allDepart:[],id:""},ruleValidate:{generalCheck:[{required:!0,type:"array",message:"不能为空",trigger:"change"}],departCheck:[{required:!0,type:"array",message:"不能为空",trigger:"change"}]},generalLeaderArr:[],loading:!1,generalCheckUser:"",treeOptions:[],normalizer:function(e){return{id:e.id,label:e.name,children:e.children}},departmentStr:"",departmentSettings:[],departLeaderArr:[],allSchoolArr:[],curActive:""}},created:function(){var e=this;this.getAllSchool().then(function(t){var o=t.data;e.allSchoolArr=o,o.length>0&&(e.curActive=o[0].id,e.getSet(o[0].id),e.selectDepart(o[0].id))})},methods:{changeSchool:function(e){this.curActive=e,this.getSet(e),this.selectDepart(e)},getSet:function(e){var t=this;this.generalLeaderArr=[],this.departLeaderArr=[],BaseAxios({method:"post",url:"/sr/storeroomData!getCheckSettingBySchoolId.action",data:{id:e}}).then(function(e){var o=e.data;if(t.setForm.isConfirmSwitch="1"===o.receiptFlag,t.setForm.generalCheckSwitch="1"===o.checkStatus,t.setForm.departCheckSwitch="1"===o.deptFlag,t.setForm.id=o.id?o.id:"","1"===o.checkStatus&&(t.generalCheckUser=o.userNames,t.setForm.generalCheck=o.userIds.split(","),o.userIds.split(",").map(function(e,c){t.generalLeaderArr.push({id:e,name:o.userNames.split(",")[c]})})),"1"===o.deptFlag){t.departmentSettings=o.departmentSettings;var c=o.departmentSettings.map(function(e){return e.departmentName});t.departmentStr=c.join(",");var a=o.departmentSettings.map(function(e){return e.departmentId}),n=o.departmentSettings.map(function(e){return e.userNames}),s=o.departmentSettings.map(function(e){return e.userIds}),m=[];c.map(function(e,o){m.push({id:a[o],name:e,checker:s[o].split(",")}),s[o].split(",").map(function(e,c){t.departLeaderArr.push({id:e,name:n[o].split(",")[c]})})}),t.setForm.departCheck=m,t.setForm.allDepart=m}}).catch(function(e){console.log(e)})},remoteMethod:function(e){var t=this;this.selectLeader(e).then(function(e){t.generalLeaderArr=e.data,t.departLeaderArr=e.data})},selectDepart:function(e){var t=this;this.treeOptions=[],this.getDepartmentTree(e).then(function(e){t.treeOptions=e.data})},onSelect:function(e,t){var o=this;e.map(function(e){o.$set(e,"checker",[])}),this.setForm.allDepart=e,this.setForm.departCheck=e,this.$refs.setForm.validateField("departCheck")},delDepartHandle:function(e){this.setForm.allDepart.splice(e,1),this.setForm.departCheck.splice(e,1)},openChange:function(){},saveSet:function(e,t,o,c,a,n,s){var m=this,r={};r["checkSettings.receiptFlag"]=e,r["checkSettings.checkStatus"]=t,r.userIds=o,r["checkSettings.deptFlag"]=c,a.map(function(e,t){r["peopleSettingVOs["+t+"].departmentId"]=e.id,r["peopleSettingVOs["+t+"].userIds"]=e.checker.join(",")}),r["checkSettings.school.id"]=n,r["checkSettings.id"]=s,BaseAxios({method:"post",url:"/sr/storeroomData!saveCheckSetting.action",data:r}).then(function(e){m.isSave=!1,m.getSet(n)}).catch(function(e){console.log(e)})},handleSubmit:function(e){var t=this;this.setForm.generalCheckSwitch||this.setForm.departCheckSwitch?this.$refs[e].validate(function(e){e&&(t.saveLoading=!0,t.saveSet(t.setForm.isConfirmSwitch?"1":"0",t.setForm.generalCheckSwitch?"1":"0",t.setForm.generalCheck.join(","),t.setForm.departCheckSwitch?"1":"0",t.setForm.allDepart,t.curActive,t.setForm.id))}):(this.saveLoading=!0,this.saveSet(this.setForm.isConfirmSwitch?"1":"0",this.setForm.generalCheckSwitch?"1":"0",this.setForm.generalCheck.join(","),this.setForm.departCheckSwitch?"1":"0",this.setForm.allDepart,this.curActive,this.setForm.id))},cancelSetHandle:function(){this.isSave=!1,this.setForm.isConfirmSwitch=!1,this.setForm.generalCheckSwitch=!1,this.setForm.departCheckSwitch=!1},editSetHandle:function(){this.isSave=!0,this.selectDepart(this.curActive)}},mounted:function(){}}),s=o("W5g0");var m=function(e){o("uIkH")},r=Object(s.a)(n,function(){var e=this,t=e.$createElement,o=e._self._c||t;return o("div",{staticClass:"zd-common-hp100"},[o("div",{staticClass:"zd-common-clearFix zd-common-hp100 zd-common-ptb20"},[o("div",{staticClass:"zd-common-fl zd-common-w200 zd-common-pl20 zd-common-pr20 zd-common-hp100 zd-common-border-right1"},[o("vue-scroll",e._l(e.allSchoolArr,function(t){return o("p",{class:[e.curActive===t.id?"zd-cm-active zd-common-p10 zd-common-cp":"zd-common-p10 zd-common-cp"],on:{click:function(o){return e.changeSchool(t.id)}}},[e._v(e._s(t.name))])}),0)],1),e._v(" "),o("div",{staticClass:"zd-common-fl zd-common-pl10 zd-common-hp100 zd-cm-fr"},[o("vue-scroll",[e.isSave?o("div",{staticClass:"zd-common-auto",staticStyle:{width:"600px"}},[o("Form",{ref:"setForm",staticClass:"zd-common-clearFix",attrs:{model:e.setForm,rules:e.ruleValidate,"label-width":150}},[o("FormItem",{attrs:{label:"是否需要收货确认："}},[o("i-switch",{staticClass:"zd-common-fl zd-common-mt8",model:{value:e.setForm.isConfirmSwitch,callback:function(t){e.$set(e.setForm,"isConfirmSwitch",t)},expression:"setForm.isConfirmSwitch"}})],1),e._v(" "),o("div",{staticClass:"zd-common-clearFix"},[o("FormItem",{staticClass:"zd-common-fl zd-common-mr10 zd-common-h38",attrs:{label:"是否需要总务审核："}},[o("i-switch",{model:{value:e.setForm.generalCheckSwitch,callback:function(t){e.$set(e.setForm,"generalCheckSwitch",t)},expression:"setForm.generalCheckSwitch"}})],1),e._v(" "),e.setForm.generalCheckSwitch?o("FormItem",{staticClass:"zd-common-fl zd-common-w300 zd-common-h38",attrs:{prop:"generalCheck","label-width":0,label:""}},[e.setForm.generalCheckSwitch?o("Select",{attrs:{placeholder:"请输入总务负责人",filterable:"",remote:"",multiple:"","remote-method":e.remoteMethod,loading:e.loading},on:{"on-open-change":e.openChange},model:{value:e.setForm.generalCheck,callback:function(t){e.$set(e.setForm,"generalCheck",t)},expression:"setForm.generalCheck"}},e._l(e.generalLeaderArr,function(t){return o("Option",{key:t.id,attrs:{value:t.id}},[e._v(e._s(t.name))])}),1):e._e()],1):e._e()],1),e._v(" "),o("div",{staticClass:"zd-common-clearFix"},[o("FormItem",{staticClass:"zd-common-fl zd-common-h38 zd-common-mr10",attrs:{label:"是否需要部门审核："}},[o("i-switch",{model:{value:e.setForm.departCheckSwitch,callback:function(t){e.$set(e.setForm,"departCheckSwitch",t)},expression:"setForm.departCheckSwitch"}})],1),e._v(" "),e.setForm.departCheckSwitch?[o("FormItem",{staticClass:"zd-common-fl zd-common-w300",attrs:{"label-width":0,label:"",prop:"departCheck"}},[o("treeselect",{staticClass:"zd-common-lh20",attrs:{valueFormat:"object",multiple:!0,options:e.treeOptions,normalizer:e.normalizer,noOptionsText:"暂无数据",placeholder:"请选择启用部门",clearable:!1},on:{close:e.onSelect},model:{value:e.setForm.departCheck,callback:function(t){e.$set(e.setForm,"departCheck",t)},expression:"setForm.departCheck"}})],1)]:e._e()],2),e._v(" "),e._l(e.setForm.allDepart,function(t,c){return e.setForm.departCheckSwitch?[o("FormItem",{staticClass:"zd-common-fl",attrs:{label:t.name+"：",prop:"allDepart."+c+".checker",rules:{required:!0,type:"array",message:"审核人不能为空",trigger:"change"}}},[o("Select",{staticClass:"zd-common-w300",attrs:{placeholder:"请输入部门审核人",filterable:"",remote:"",multiple:"","remote-method":e.remoteMethod,loading:e.loading},on:{"on-open-change":e.openChange},model:{value:e.setForm.allDepart[c].checker,callback:function(t){e.$set(e.setForm.allDepart[c],"checker",t)},expression:"setForm.allDepart[index].checker"}},e._l(e.departLeaderArr,function(t){return o("Option",{key:t.id,attrs:{value:t.id}},[e._v(e._s(t.name))])}),1)],1),e._v(" "),o("Icon",{staticClass:"zd-common-cp zd-common-fl zd-common-fs20 zd-common-mt8",attrs:{type:"ios-close"},on:{click:function(t){return e.delDepartHandle(c)}}})]:e._e()})],2),e._v(" "),o("div",{staticClass:"zd-common-modal-footer zd-common-pt10",attrs:{slot:"footer"},slot:"footer"},[o("Button",{staticClass:"zd-common-mr35 zd-common-w100 zd-common-h32 zd-common-lh8",attrs:{type:"primary",loading:e.saveLoading},on:{click:function(t){return e.handleSubmit("setForm")}}},[e.saveLoading?o("span",[e._v("正在保存...")]):o("span",[e._v("保存")])]),e._v(" "),o("Button",{staticClass:"zd-common-w100 zd-common-h32 zd-common-lh8",on:{click:e.cancelSetHandle}},[e._v("取消")])],1)],1):o("div",{staticClass:" zd-common-auto",staticStyle:{width:"520px"}},[o("div",{staticClass:"zd-common-pr20"},[o("p",{staticClass:"zd-common-clearFix"},[o("span",{staticClass:"zd-common-fl zd-common-w150 zd-common-dib zd-common-tr"},[e._v("是否需要收货确认：")]),e._v(" "),o("span",{staticClass:"zd-common-fl zd-common-border-bottom1 zd-common-w100 zd-common-dib zd-common-pb5"},[e._v("\n                  "+e._s(e.setForm.isConfirmSwitch?"是":"否")+"\n                ")])]),e._v(" "),o("div",{staticClass:"zd-common-clearFix zd-common-mt20"},[o("p",{staticClass:"zd-common-fl"},[o("span",{staticClass:"zd-common-fl zd-common-w150 zd-common-dib zd-common-tr"},[e._v("总务是否需要审核：")]),e._v(" "),o("span",{staticClass:"zd-common-fl zd-common-border-bottom1 zd-common-w100 zd-common-dib zd-common-pb5"},[e._v("\n                    "+e._s(e.setForm.generalCheckSwitch?"是":"否")+"\n                  ")])]),e._v(" "),e.setForm.generalCheckSwitch?o("p",{staticClass:"zd-common-fl"},[o("span",{staticClass:"zd-common-fl zd-common-w150 zd-common-dib zd-common-tr"},[e._v("总务审核人：")]),e._v(" "),o("span",{staticClass:"zd-common-fl zd-common-border-bottom1 zd-common-w100 zd-common-dib zd-common-pb5"},[e._v(e._s(e.generalCheckUser))])]):e._e()]),e._v(" "),o("div",{staticClass:"zd-common-clearFix zd-common-mt20"},[o("p",{staticClass:"zd-common-fl"},[o("span",{staticClass:"zd-common-fl zd-common-w150 zd-common-dib zd-common-tr"},[e._v("部门是否需要审核：")]),e._v(" "),o("span",{staticClass:"zd-common-fl zd-common-border-bottom1 zd-common-w100 zd-common-dib zd-common-pb5"},[e._v("\n                    "+e._s(e.setForm.departCheckSwitch?"是":"否")+"\n                  ")])]),e._v(" "),e.setForm.departCheckSwitch?o("p",{staticClass:"zd-common-fl"},[o("span",{staticClass:"zd-common-fl zd-common-w150 zd-common-dib zd-common-tr"},[e._v("启用部门：")]),e._v(" "),o("span",{staticClass:"zd-common-fl zd-common-border-bottom1 zd-common-w100 zd-common-dib zd-common-pb5"},[e._v(e._s(e.departmentStr))])]):e._e()]),e._v(" "),e.setForm.departCheckSwitch?o("p",{staticClass:"zd-common-mt20 zd-common-clearFix"},[e._l(e.departmentSettings,function(t){return[o("span",{staticClass:"zd-common-fl zd-common-w150 zd-common-dib zd-common-tr"},[e._v(e._s(t.departmentName)+"：")]),e._v(" "),o("span",{staticClass:"zd-common-fl zd-common-w350 zd-common-border-bottom1 zd-common-pb5"},[e._v(e._s(t.userNames))])]})],2):e._e()]),e._v(" "),o("div",{staticClass:"zd-common-tc zd-common-mt30"},[o("Button",{staticClass:"zd-common-w100 zd-common-h32 zd-common-lh8",attrs:{type:"primary"},on:{click:e.editSetHandle}},[e._v("编辑\n              ")])],1)])])],1)])])},[],!1,m,"data-v-86a35f94",null);t.default=r.exports},uIkH:function(e,t){}});
//# sourceMappingURL=20.32e0cb321efd63ed7f28.js.map